# APIC-EM APIs with Python: Part 1 - The Basics


## Objective

Completion Time: 20 minutes

This document helps you learn:
* The basics of the APIC-EM API calls
* How to write custom scripts in Python that make APIC-EM API calls 

Estimated completion time: 20 minutes

## Prerequisites

You should be familiar with REST APIs and JSON, and should have basic proficiency with Python or a similar high-level programming language.

If you are not familiar with the these topics, you can complete the [Coding 101: REST API Basics Lab](https://learninglabs.cisco.com/labs/coding-101-rest-basics-ga/step/1) before returning to this lab.

You will need to make API calls to an APIC-EM controller. By default, these labs are configured to use the [Cisco DevNet Sandbox’s](https://developer.cisco.com/site/devnet/sandbox/) APIC-EM controller: https://devnetapi.cisco.com/sandbox/apic_em.


## Set Up Your Machine

To set up your system, complete the following steps. (If you are using Cisco-provided hardware or have already set up these items, you can probably skip to the next section.)

### Install Git
Download and install Git from [https://git-scm.com/downloads]

### Install Python 3.x
Download and install Python 3.x from [https://www.python.org/downloads/]

### Install the Requests Library
Download and install [Requests: HTTP for Humans](http://docs.python-requests.org/en/latest/) for Python your operating system.

For Mac OS, use these commands:
```bash
sudo curl -O https://raw.githubusercontent.com/pypa/pip/master/contrib/get-pip.py
sudo python3 get-pip.py
pip3 install requests
```
           
For Windows, complete these steps:
1. Pip comes with Python 3.4 on Windows. Check to see if Pip is in your python 3 path by entering:
```bash
C:\>pip –V
pip 1.5.6 from C:\Python34\lib\site-packages
```
               
If pip is in the Python34 path, enter:
```bash
pip install requests
```

### Clone and Configure the APIC-EM Git Repo

If you are using Cisco-provided hardware at a Cisco event the following tasks have probably been completed:
* The lab sample code has been downloaded to `C:\apicem-apis-with-python-sample-codes\basic-labs`
* The `APICEM_IP` parameter in the `apicem_config.py` configuration file is configured to use an APIC-EM controller that’s available for training purposes. 

If so, you can probably skip to the next section. 

Create a working directory. For example:
```bash
mkdir \workingdir\
```

Clone the APIC-EM sample code to your working directory. For example:
```bash
cd \workingdir\
git clone https://github.com/CiscoDevNet/apicem-apis-with-python-sample-codes
```

After the git clone completes, you have the Python files used in the following labs.

By default these files are configured to send API calls to the sandboxed Cisco APIC-EM controller, as shown here:
```
APICEM_IP = "devnetapi.cisco.com/sandbox/apic_em"
```

To use a different controller, locate the `apicem_config.py`configuration file. For example: `username/workingdir/apicem-apis-with-python-sample-codes/basic-labs/apicem_config.py`

Edit the file and assign the URL or IP address of the APIC-EM controller you’ll be using to the the `APICEM_IP` variable. If the controller is configured to listen on a specific port number, include the value of the port number in the URL or IP address.

## Learn the basics of the APIC-EM REST API

### Overview

The APIC-EM Controller exposes a northbound REST API to enterprise, WAN, and campus networks. The controller’s network programmability and automated network control helps IT organization respond to rapidly changing network conditions and business opportunities.

The APIC-EM Controller also has southbound interfaces connected to the network control plane. The controller uses these interfaces to execute the commands it receives from the northbound REST API. Thus, you can use the REST API to manage the controller and add dynamic SDN functionality directly into your own applications.

### Running the Scripts

To run the scripts in this lab:
* In a Mac OS or Linux terminal, enter `python3 scriptName`
* At Windows command prompt, enter `py –3 scriptName` or `python scriptName`

Alternatively, you can use the Python IDE, IDLE:
* In Mac OS terminal, entering `idle3` brings up IDLE for Python3.
* In Windows, use the **Start** menu to open IDLE.

### Shorthand Notation of APIC-EM NB REST API URLs
A complete REST request to the Cisco APIC-EM controller takes the form of a URL such as this one:
```
https://fqdn-Or-IPofController/api/v1/api_itself
```

Where:
* `https://fqdn-Or-IPofController` is the *base URL*. If needed, it includes a port number.
* `api/v1/` is the version number of the NB REST API
* `/api_itself` is the API end point.

### Issuing HTTP Requests from Python

The APIC-EM REST API uses the following standard HTTP "CRUD" methods to create, read, update, and delete:
* **POST** - Create new data
* **GET** - Read (Retrieve) existing data
* **PUT** - Update existing data
* **DELETE** - Delete existing data

**Note:** For security, APIC-EM API always formats the POST and PUT request’s parameters and arguments as JSON-formatted key-value pairs inside the request payload.

The following code snippets show how to use the Python requests library to issue each of these HTTP requests.

#### GET

To get existing data, a Python script issues a GET request like this:

```python
import requests
url = "https://fqdn-Or-IPofController/api/v1/api_itself"
response = requests.get(url,verify=False)
verify=False means not verifying the SSL certificate
```

#### POST

To create new data, a Python script issues a POST request like this:

```python
import requests 
import json 
 
json_obj = { 
"key":"value" 
} 
url = "https://fqdn-Or-IPofController/api/v1/api_itself" 
# need to specify content type -json- for POST request # 
headers = {'content-type': 'application/json'} 
response = requests.post(url, json.dumps(json_object), headers=headers,verify=False) 
```

#### PUT
A PUT request modifies existing data. 

```python
import requests 
import json 
 
json_obj = { 
"key":"value_to_change" 
} 
url = "https://fqdn-Or-IPofController/api/v1/api_itself" 
# need to specify content type -json- for PUT request # 
headers = {'content-type': 'application/json'} 
response = requests.put(url, json.dumps(json_object), headers=headers,verify=False) 
```

#### DELETE

A DELETE request removes existing data.

```python
import requests 
url = "https://fqdn-Or-IPofController/api/v1/api_itself" 
response = requests.delete(url,verify=False) 
```

### APIC-EM REST API Reference
For detailed information about the NB REST APIs for the Cisco APIC-EM controller, see the 
[Cisco APIC-EM API Reference Docs](http://devnetapic.cisco.com/)

#### Next Steps
The following labs create simple Python applications that interact with the Cisco APIC-EM controller' API. We recommend that you run the scripts in each lab session to see the live responses from APIC-EM controller.

* Lab 1: Generate a new service ticket and get information of all APIC-EM users
* Lab 2: Network Device Related APIs
